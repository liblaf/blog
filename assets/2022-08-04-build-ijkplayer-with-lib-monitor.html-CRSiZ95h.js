import{_ as l,r,o as a,c as d,a as e,b as o,d as i,e as n}from"./app-CoV9NwP4.js";const s={},c=e("h2",{id:"environment-setup",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#environment-setup"},[e("span",null,"Environment Setup")])],-1),p=e("code",null,"ijkplayer",-1),h={href:"https://github.com/liblaf/ijkplayer",target:"_blank",rel:"noopener noreferrer"},u=e("code",null,"lib-monitor",-1),m={href:"https://github.com/liblaf/lib-monitor",target:"_blank",rel:"noopener noreferrer"},b=e("code",null,"LLVM@9",-1),g={href:"https://formulae.brew.sh/formula/llvm@9",target:"_blank",rel:"noopener noreferrer"},f=e("code",null,"NDK-r14b",-1),_={href:"https://dl.google.com/android/repository/android-ndk-r14b-linux-x86_64.zip",target:"_blank",rel:"noopener noreferrer"},v=e("code",null,"NDK-r21e",-1),k={href:"https://dl.google.com/android/repository/android-ndk-r21e-linux-x86_64.zip",target:"_blank",rel:"noopener noreferrer"},y=e("code",null,"Android Studio 2.3.3",-1),x={href:"https://redirector.gvt1.com/edgedl/android/studio/ide-zips/2.3.3.0/android-studio-ide-162.4069837-linux.zip",target:"_blank",rel:"noopener noreferrer"},w=n(`<ol><li>prepare the environment as shown above</li><li>follow instructions <a href="#get-missing-parts-of-ndk">below</a> to get missing parts of <code>NDK</code></li><li>configure variables in <code>ijkplayer/build.sh</code> and <code>lib-monitor/inserter/Makefile</code> according to your setup</li><li>click <code>AVD Manager</code> and create a device with the following system image:</li></ol><table><thead><tr><th>Release Name</th><th>API Level</th><th>ABI</th><th>Target</th></tr></thead><tbody><tr><td>Nougat</td><td>25</td><td><code>armeabi-v7a</code></td><td>Android 7.1.1 (Google APIs)</td></tr></tbody></table><h3 id="get-missing-parts-of-ndk" tabindex="-1"><a class="header-anchor" href="#get-missing-parts-of-ndk"><span>Get Missing Parts of <code>NDK</code><sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup></span></a></h3><div class="hint-container info"><p class="hint-container-title">Info</p><p>We are going to use <code>NDK-r21e</code>.</p></div><p>Version information is in file <code>\${ANDROID_NDK}/toolchains/llvm/prebuilt/linux-x86_64/AndroidVersion.txt</code>.</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>9.0.9
based on r365631c3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,6),D={href:"https://android.googlesource.com/platform/prebuilts/clang/host/linux-x86/+/refs/tags/ndk-r21e/clang-r365631c3/",target:"_blank",rel:"noopener noreferrer"},A={href:"https://android.googlesource.com/platform/prebuilts/clang/host/linux-x86/+archive/refs/tags/ndk-r21e/clang-r365631c3.tar.gz",target:"_blank",rel:"noopener noreferrer"},N=e("li",null,[o("extract the downloaded file and merge it with "),e("code",null,"${ANDROID_NDK}/toolchains/llvm/prebuilt/linux-x86_64"),o(".")],-1),j=n(`<div class="hint-container tip"><p class="hint-container-title">Tips</p><p>You may want to remove <code>clang.real</code> and <code>clang++.real</code> under <code>\${ANDROID_NDK}/toolchains/llvm/prebuilt/linux-x86_64/bin/</code>.</p></div><h2 id="build" tabindex="-1"><a class="header-anchor" href="#build"><span>Build</span></a></h2><ol><li>launch Android Studio, select <code>android/ijkplayer/</code> and import</li><li>install dependencies according to logs from Android Studio</li><li>run the following scripts:</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">bash</span> init-android.sh
<span class="token function">bash</span> build.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">Note</p><p>We choose to use <code>NDK-r21e</code> for <code>ffmpeg</code> and <code>NDK-r14b</code> for anything else. There are both <code>c</code> and <code>c++</code> sources elsewhere. However, the <code>-std=c99</code> option ( configured in <code>Android.mk</code> ) will cause an error in <code>NDK-r21e</code> ( with newer <code>clang++</code> ) but simply a warning in <code>NDK-r14b</code>.</p></div><h2 id="run" tabindex="-1"><a class="header-anchor" href="#run"><span>Run</span></a></h2><ol><li>click <code>Run selected configuration</code> or press <code>shift + F10</code> in Android Studio</li><li>click <code>Sample</code> in Android Emulator</li><li>choose a video from the list and click</li></ol><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>When sliding the video list, the simulator may treat the wheel scroll as a click event, so the safe way is to hold down the mouse and drag.</p></div><div class="hint-container info"><p class="hint-container-title">Info</p><p>Sometimes the player would crash. Just try to reopen the video from the list. I’m currently working for a solution.</p></div><h2 id="debug" tabindex="-1"><a class="header-anchor" href="#debug"><span>Debug</span></a></h2><h3 id="adb" tabindex="-1"><a class="header-anchor" href="#adb"><span>ADB</span></a></h3><p>By default, you may find the executable <code>adb</code> at <code>&quot;\${HOME}/Android/Sdk/platform-tools/adb&quot;</code>. Here are some commonly used <code>adb</code> commands:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./adb devices <span class="token punctuation">[</span>-l<span class="token punctuation">]</span> <span class="token comment"># list connected devices (-l for long output)</span>
./adb shell <span class="token comment"># run remote shell command (interactive shell if no command given)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>You can enter interactive shell and <code>cd</code> to <code>/sdcard/</code> to see whether <code>recorder.cov</code> has been created.</p><h3 id="logcat" tabindex="-1"><a class="header-anchor" href="#logcat"><span>logcat</span></a></h3><p>In Android Studio, click <code>6: Android Monitor</code> and click <code>logcat</code> tab to view <code>logcat</code>. In addition, you can change the level of logging and use the search box ( for example <code>&quot;lib-monitor&quot;</code> ) to filter logs.</p><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>Reference</span></a></h2><hr class="footnotes-sep">`,18),S={class:"footnotes"},z={class:"footnotes-list"},K={id:"footnote1",class:"footnote-item"},T={href:"https://xz.aliyun.com/t/6643",target:"_blank",rel:"noopener noreferrer"},M=e("a",{href:"#footnote-ref1",class:"footnote-backref"},"↩︎",-1);function B(V,I){const t=r("ExternalLinkIcon");return a(),d("div",null,[c,e("ul",null,[e("li",null,[p,o(": "),e("a",h,[o("liblaf/ijkplayer: Android/iOS video player based on FFmpeg n3.4, with MediaCodec, VideoToolbox support."),i(t)])]),e("li",null,[u,o(": "),e("a",m,[o("liblaf/lib-monitor"),i(t)])]),e("li",null,[b,o(": "),e("a",g,[o("llvm@9 — Homebrew Formulae"),i(t)])]),e("li",null,[f,o(": "),e("a",_,[o("android-ndk-r14b-linux-x86_64.zip"),i(t)])]),e("li",null,[v,o(": "),e("a",k,[o("android-ndk-r21e-linux-x86_64.zip"),i(t)])]),e("li",null,[y,o(": "),e("a",x,[o("android-studio-ide-162.4069837-linux.zip"),i(t)])])]),w,e("ol",null,[e("li",null,[o("visit the corresponding source at "),e("a",D,[o("clang-r365631c3 - platform/prebuilts/clang/host/linux-x86 - Git at Google"),i(t)]),o(" and download "),e("a",A,[o("tgz"),i(t)])]),N]),j,e("section",S,[e("ol",z,[e("li",K,[e("p",null,[e("a",T,[o("史上最优雅的 NDK 加载 pass 方案 - 先知社区"),i(t)]),o(),M])])])])])}const F=l(s,[["render",B],["__file","2022-08-04-build-ijkplayer-with-lib-monitor.html.vue"]]),R=JSON.parse('{"path":"/2022/research/idea/2022-08-04-build-ijkplayer-with-lib-monitor.html","title":"Build ijkplayer with lib-monitor","lang":"en-US","frontmatter":{"date":"2022-08-04T00:00:00.000Z","isOriginal":true,"category":["Research"],"tag":["Android","Clang","NDK","ijkplayer"],"title":"Build ijkplayer with lib-monitor","description":"Environment Setup ijkplayer: liblaf/ijkplayer: Android/iOS video player based on FFmpeg n3.4, with MediaCodec, VideoToolbox support. lib-monitor: liblaf/lib-monitor LLVM@9: llvm...","head":[["meta",{"property":"og:url","content":"https://blog.liblaf.me/2022/research/idea/2022-08-04-build-ijkplayer-with-lib-monitor.html"}],["meta",{"property":"og:site_name","content":"Blog"}],["meta",{"property":"og:title","content":"Build ijkplayer with lib-monitor"}],["meta",{"property":"og:description","content":"Environment Setup ijkplayer: liblaf/ijkplayer: Android/iOS video player based on FFmpeg n3.4, with MediaCodec, VideoToolbox support. lib-monitor: liblaf/lib-monitor LLVM@9: llvm..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-03-03T09:57:39.000Z"}],["meta",{"property":"article:author","content":"liblaf"}],["meta",{"property":"article:tag","content":"Android"}],["meta",{"property":"article:tag","content":"Clang"}],["meta",{"property":"article:tag","content":"NDK"}],["meta",{"property":"article:tag","content":"ijkplayer"}],["meta",{"property":"article:published_time","content":"2022-08-04T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-03-03T09:57:39.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Build ijkplayer with lib-monitor\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-08-04T00:00:00.000Z\\",\\"dateModified\\":\\"2024-03-03T09:57:39.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"liblaf\\",\\"url\\":\\"https://liblaf.me\\",\\"email\\":\\"i@liblaf.me\\"}]}"]]},"headers":[{"level":2,"title":"Environment Setup","slug":"environment-setup","link":"#environment-setup","children":[{"level":3,"title":"Get Missing Parts of NDK","slug":"get-missing-parts-of-ndk","link":"#get-missing-parts-of-ndk","children":[]}]},{"level":2,"title":"Build","slug":"build","link":"#build","children":[]},{"level":2,"title":"Run","slug":"run","link":"#run","children":[]},{"level":2,"title":"Debug","slug":"debug","link":"#debug","children":[{"level":3,"title":"ADB","slug":"adb","link":"#adb","children":[]},{"level":3,"title":"logcat","slug":"logcat","link":"#logcat","children":[]}]},{"level":2,"title":"Reference","slug":"reference","link":"#reference","children":[]}],"git":{"createdTime":1677217008000,"updatedTime":1709459859000,"contributors":[{"name":"liblaf","email":"30631553+liblaf@users.noreply.github.com","commits":3}]},"readingTime":{"minutes":1.68,"words":504},"filePathRelative":"2022/research/idea/2022-08-04-build-ijkplayer-with-lib-monitor.md","localizedDate":"August 4, 2022","excerpt":"<h2>Environment Setup</h2>\\n<ul>\\n<li><code>ijkplayer</code>: <a href=\\"https://github.com/liblaf/ijkplayer\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">liblaf/ijkplayer: Android/iOS video player based on FFmpeg n3.4, with MediaCodec, VideoToolbox support.</a></li>\\n<li><code>lib-monitor</code>: <a href=\\"https://github.com/liblaf/lib-monitor\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">liblaf/lib-monitor</a></li>\\n<li><code>LLVM@9</code>: <a href=\\"https://formulae.brew.sh/formula/llvm@9\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">llvm@9 — Homebrew Formulae</a></li>\\n<li><code>NDK-r14b</code>: <a href=\\"https://dl.google.com/android/repository/android-ndk-r14b-linux-x86_64.zip\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">android-ndk-r14b-linux-x86_64.zip</a></li>\\n<li><code>NDK-r21e</code>: <a href=\\"https://dl.google.com/android/repository/android-ndk-r21e-linux-x86_64.zip\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">android-ndk-r21e-linux-x86_64.zip</a></li>\\n<li><code>Android Studio 2.3.3</code>: <a href=\\"https://redirector.gvt1.com/edgedl/android/studio/ide-zips/2.3.3.0/android-studio-ide-162.4069837-linux.zip\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">android-studio-ide-162.4069837-linux.zip</a></li>\\n</ul>","autoDesc":true}');export{F as comp,R as data};
